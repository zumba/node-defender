extends game_layout

block scripts
	script.
		var secureClient = #{secure};
	script(src="#{host}/socket.io/socket.io.js")
	script(src="/js/vendor/ace/ace.js")
	script(src="/js/vendor/sprintf.min.js")
	script(src="/js/commander.js")
	script(src="/js/round_info.js")
	script(src="/js/brain.js")
	script(src="/js/blabber.js")
	script(src="/js/client.js")
	script.
		$(function() {
			var editor = ace.edit("editor");
			var startedGames = 0;
			editor.setTheme("ace/theme/monokai");
			editor.getSession().setMode("ace/mode/javascript");
			editor.getSession().setValue(Brain.retrieveStrategy());
			$('#start').on('click', function(e) {
				if (typeof ga === 'function') {
					ga('send', 'event', 'game', 'start', 'Start Game', ++startedGames);
				}
				e.preventDefault();
				Client.start(
					'#{username}', 
					editor.getSession().getValue(),
					{
						token: '#{token}',
						secret: '#{secret}'
					}						
				);
			});
			$('#reset').on('click', function(e) {
				editor.getSession().setValue(Brain.getBaseStrategy());
			});
			// Assign a global error handler from the client
			window.onerror = Client.onerror;
		});

block content
	.row
		.col-lg-12
			button(type="button")#start.btn.btn-primary.pull-right Start Game
			button(type="button")#reset.btn.btn-danger.pull-left Reset
		br
		br
	.row
		.col-lg-7
			#editor-panel.panel.panel-primary
				.panel-heading Code Editor
				#editor.panel-body
		.col-md-5
			#console-panel.panel.panel-primary
				.panel-heading Console
				#consolelog.panel-body
	code#base-strategy.hidden.
		// Available variables:
		// _ - Access to underscore
		// roundInfo - API for retrieving information from the server
		// commander - API for sending commands to the server

		var enemy, attackModes;

		// Find the first enemy and target it.
		enemy = _.first(roundInfo.getMobs());

		// Target the enemy
		commander.target(enemy.id);

		// Select the attack mode
		commander.attackMode('power');
